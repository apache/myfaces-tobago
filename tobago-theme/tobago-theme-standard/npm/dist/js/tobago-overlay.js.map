{"version":3,"file":"tobago-overlay.js","sourceRoot":"../ts/","sources":["tobago-overlay.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Create a overlay barrier and animate it.\n */\n\nimport {Config} from \"./tobago-config\";\nimport {Page} from \"./tobago-page\";\n\n// XXX issue: if a ajax call is scheduled on the same element, the animation arrow will stacking and not desapearing.\n// XXX issue: \"error\" is not implemented correctly\n// see http://localhost:8080/demo-5-snapshot/content/30-concept/50-partial/Partial_Ajax.xhtml to use this feature\n// XXX todo: check full page transitions\n\nexport class Overlay {\n\n  private static readonly overlayMap: Map<string, Overlay> = new Map<string, Overlay>();\n\n  /**\n   * Is this overlay for an AJAX request, or an normal submit?\n   * We need this information, because AJAX need to clone the animated image, but for a normal submit\n   * we must not clone it, because the animation stops in some browsers.\n   */\n  ajax: boolean = true;\n\n  /**\n   * This boolean indicates, if the overlay is \"error\" or \"wait\".\n   */\n  error: boolean = false;\n\n  /**\n   * The delay for the wait overlay. If not set the default delay is read from Tobago.Config.\n   */\n  waitOverlayDelay: number = 0;\n\n  element: HTMLElement;\n\n  overlay: HTMLDivElement;\n\n  static destroy(id: string): void {\n    console.debug(\"----> get overlay \" + id);\n    const overlay = Overlay.overlayMap.get(id);\n    if (overlay) {\n      overlay.overlay.remove();\n      Overlay.overlayMap.delete(id);\n    } else {\n      console.warn(\"Overlay not found for id='\" + id + \"'\");\n    }\n  }\n\n  constructor(element: HTMLElement, ajax = false, error = false, waitOverlayDelay?) {\n\n    this.element = element;\n    this.ajax = ajax;\n    this.error = error;\n    this.waitOverlayDelay = waitOverlayDelay\n        ? waitOverlayDelay\n        : Config.get(this.ajax ? \"Ajax.waitOverlayDelay\" : \"Tobago.waitOverlayDelay\");\n\n    // create the overlay\n\n    this.overlay = document.createElement(\"div\");\n    this.overlay.classList.add(\"tobago-page-overlay\");\n    this.overlay.classList.add(this.error ? \"tobago-page-overlay-markup-error\" : null);\n\n    let left = \"0\";\n    let top = \"0\";\n    if (this.element.matches(\"body\")) {\n      this.overlay.style.position = \"fixed\";\n      this.overlay.style.zIndex = \"1500\"; // greater than the bootstrap navbar\n    } else {\n      const rect = this.element.getBoundingClientRect();\n      left = (rect.left + document.body.scrollLeft) + \"px\";\n      top = (rect.top + document.body.scrollTop) + \"px\";\n      this.overlay.style.width = this.element.offsetWidth + \"px\";\n      this.overlay.style.height = this.element.offsetHeight + \"px\";\n// tbd: is this still needed?       this.overlay.style.position= \"absolute\"\n// XXX is set via class, but seams to be overridden in IE11?\n    }\n\n    document.getElementsByTagName(\"body\")[0].append(this.overlay);\n\n    let wait = document.createElement(\"div\");\n    wait.classList.add(\"tobago-page-overlayCenter\");\n    this.overlay.append(wait);\n\n    let image = document.createElement(\"i\");\n    if (this.error) {\n      image.classList.add(\"fa\", \"fa-flash\", \"fa-3x\");\n      wait.classList.add(\"alert-danger\");\n    } else {\n      image.classList.add(\"fa\", \"fa-refresh\", \"fa-3x\", \"fa-spin\");\n      image.style.opacity = \"0.4\";\n    }\n    wait.append(image);\n    wait.style.display = \"\"; //XXX ?\n\n    this.overlay.style.backgroundColor = Page.page(this.element).style.backgroundColor;\n    this.overlay.style.left = left;\n    this.overlay.style.top = top;\n    setTimeout(() => { // to play the CSS transition\n      this.overlay.classList.add(\"tobago-page-overlay-timeout\");\n    }, this.waitOverlayDelay);\n\n    Overlay.overlayMap.set(element.id, this);\n    console.debug(\"----> set overlay \" + element.id);\n  }\n}\n\nConfig.set(\"Tobago.waitOverlayDelay\", 1000);\nConfig.set(\"Ajax.waitOverlayDelay\", 1000);\n"]}