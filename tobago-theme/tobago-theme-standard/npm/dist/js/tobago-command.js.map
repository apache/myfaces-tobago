{"version":3,"file":"tobago-command.js","sourceRoot":"../ts/","sources":["tobago-command.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Listener} from \"./tobago-listener\";\nimport {Overlay} from \"./tobago-overlay\";\nimport {Collapse} from \"./tobago-popup\";\nimport {Page} from \"./tobago-page\";\n\nclass Behavior extends HTMLElement {\n\n  constructor() {\n    super();\n  }\n\n  connectedCallback(): void {\n    switch (this.event) {\n      case \"load\": // this is a special case, because the \"load\" is too late now.\n        this.callback();\n        break;\n      case \"resize\":\n        document.body.addEventListener(this.event, this.callback.bind(this));\n        break;\n      default:\n        const eventElement = this.eventElement;\n        if (eventElement) {\n          eventElement.addEventListener(this.event, this.callback.bind(this));\n        } else {\n          // if the clientId doesn't exists in DOM, it's probably the id of tobago-behavior custom element\n          this.parentElement.addEventListener(this.event, this.callback.bind(this));\n          // todo: not sure if this warning can be removed;\n          console.warn(\"Can't find an element for the event. Use parentElement instead.\", this);\n        }\n    }\n  }\n\n  callback(event?: Event): void {\n\n    if (this.collapseAction && this.collapseTarget) {\n      const rootNode = this.getRootNode() as ShadowRoot | Document;\n      Collapse.execute(this.collapseAction, rootNode.getElementById(this.collapseTarget));\n    }\n\n    if (this.execute || this.render) { // this means: AJAX case?\n      if (this.render) {\n        // prepare overlay for all by AJAX reloaded elements\n        const partialIds = this.render.split(\" \");\n        for (let i = 0; i < partialIds.length; i++) {\n          const partialElement = document.getElementById(partialIds[i]);\n          if (partialElement) {\n            new Overlay(partialElement, true);\n          } else {\n            console.warn(\"No element found by id='%s' for overlay!\", partialIds[i]);\n          }\n        }\n      }\n      jsf.ajax.request(\n          this.actionElement,\n          event,\n          {\n            \"javax.faces.behavior.event\": this.event,\n            execute: this.execute,\n            render: this.render\n          });\n    } else {\n      if (!this.omit) {\n        setTimeout(this.submit.bind(this), this.delay);\n      }\n    }\n  }\n\n  submit(): void {\n    const id = this.fieldId != null ? this.fieldId : this.clientId;\n    CommandHelper.submitAction(this, id, this.decoupled, this.target);\n  }\n\n  get event(): string {\n    return this.getAttribute(\"event\");\n  }\n\n  set event(event: string) {\n    this.setAttribute(\"event\", event);\n  }\n\n  get clientId(): string {\n    return this.getAttribute(\"client-id\");\n  }\n\n  set clientId(clientId: string) {\n    this.setAttribute(\"client-id\", clientId);\n  }\n\n  get fieldId(): string {\n    return this.getAttribute(\"field-id\");\n  }\n\n  set fieldId(fieldId: string) {\n    this.setAttribute(\"field-id\", fieldId);\n  }\n\n  get execute(): string {\n    return this.getAttribute(\"execute\");\n  }\n\n  set execute(execute: string) {\n    this.setAttribute(\"execute\", execute);\n  }\n\n  get render(): string {\n    return this.getAttribute(\"render\");\n  }\n\n  set render(render: string) {\n    this.setAttribute(\"render\", render);\n  }\n\n  get delay(): number {\n    return parseInt(this.getAttribute(\"delay\")) || 0;\n  }\n\n  set delay(delay: number) {\n    this.setAttribute(\"delay\", String(delay));\n  }\n\n  get omit(): boolean {\n    return this.hasAttribute(\"omit\");\n  }\n\n  set omit(omit: boolean) {\n    if (omit) {\n      this.setAttribute(\"omit\", \"\");\n    } else {\n      this.removeAttribute(\"omit\");\n    }\n  }\n\n  get target(): string {\n    return this.getAttribute(\"target\");\n  }\n\n  set target(target: string) {\n    this.setAttribute(\"target\", target);\n  }\n\n  get confirmation(): string {\n    return this.getAttribute(\"confirmation\");\n  }\n\n  set confirmation(confirmation: string) {\n    this.setAttribute(\"confirmation\", confirmation);\n  }\n\n  get collapseAction(): string {\n    return this.getAttribute(\"collapse-action\");\n  }\n\n  set collapseAction(collapseAction: string) {\n    this.setAttribute(\"collapse-action\", collapseAction);\n  }\n\n  get collapseTarget(): string {\n    return this.getAttribute(\"collapse-target\");\n  }\n\n  set collapseTarget(collapseTarget: string) {\n    this.setAttribute(\"collapse-target\", collapseTarget);\n  }\n\n  get decoupled(): boolean {\n    return this.hasAttribute(\"decoupled\");\n  }\n\n  set decoupled(decoupled: boolean) {\n    if (decoupled) {\n      this.setAttribute(\"decoupled\", \"\");\n    } else {\n      this.removeAttribute(\"decoupled\");\n    }\n  }\n\n  get actionElement(): HTMLElement {\n    const rootNode = this.getRootNode() as ShadowRoot | Document;\n    const id = this.clientId;\n    return rootNode.getElementById(id);\n  }\n\n  get eventElement(): HTMLElement {\n    const rootNode = this.getRootNode() as ShadowRoot | Document;\n    const id = this.fieldId ? this.fieldId : this.clientId;\n    return rootNode.getElementById(id);\n  }\n\n  /* XXX todo:\n    get element(): HTMLElement {\n      let e = this.parentElement;\n      // XXX special case, using the row, but <tobago-behavior> can't be a child of <tr>\n      while (e.matches(\"td.tobago-sheet-cell-markup-filler\")\n      // XXX fix position of <tobago-behavior> inside of input-group\n      || e.matches(\".input-group\")\n      || e.matches(\".tobago-input-group-outer\")) {\n        e = e.parentElement;\n      }\n      return e;\n    }\n  */\n\n}\n\ndocument.addEventListener(\"tobago.init\", function (event: Event): void {\n  if (window.customElements.get(\"tobago-behavior\") == null) {\n    window.customElements.define(\"tobago-behavior\", Behavior);\n  }\n});\n\nexport class CommandHelper {\n  static isSubmit: boolean = false;\n\n  /**\n   * Submitting the page with specified actionId.\n   * @param source\n   * @param actionId\n   * @param decoupled\n   * @param target\n   */\n  public static submitAction = function (\n      source: HTMLElement, actionId: string, decoupled: boolean = false, target?: string): void {\n\n    Transport.request(function (): void {\n      if (!CommandHelper.isSubmit) {\n        CommandHelper.isSubmit = true;\n        const form = document.getElementsByTagName(\"form\")[0] as HTMLFormElement;\n        const oldTarget = form.getAttribute(\"target\");\n        const sourceHidden = document.getElementById(\"javax.faces.source\") as HTMLInputElement;\n        sourceHidden.disabled = false;\n        sourceHidden.value = actionId;\n        if (target) {\n          form.setAttribute(\"target\", target);\n        }\n        const listenerOptions = {\n          source: source,\n          actionId: actionId/*,\n          options: commandHelper*/\n        };\n        const onSubmitResult = CommandHelper.onSubmit(listenerOptions);\n        if (onSubmitResult) {\n          try {\n            form.submit();\n            // reset the source field after submit, to be prepared for possible next AJAX with decoupled=true\n            sourceHidden.disabled = true;\n            sourceHidden.value = \"\";\n          } catch (e) {\n            Overlay.destroy(Page.page(form).id);\n            CommandHelper.isSubmit = false;\n            alert(\"Submit failed: \" + e); // XXX localization, better error handling\n          }\n        }\n        if (target) {\n          if (oldTarget) {\n            form.setAttribute(\"target\", oldTarget);\n          } else {\n            form.removeAttribute(\"target\");\n          }\n        }\n        if (target || decoupled || !onSubmitResult) {\n          CommandHelper.isSubmit = false;\n          Transport.pageSubmitted = false;\n        }\n      }\n      if (!CommandHelper.isSubmit) {\n        Transport.requestComplete(); // remove this from queue\n      }\n    }, true);\n  };\n\n  static onSubmit = function (listenerOptions: any): boolean {\n    Listener.executeBeforeSubmit();\n    /*\n    XXX check if we need the return false case\n    XXX maybe we cancel the submit, but we continue the rest?\n    XXX should the other phases also have this feature?\n\n        var result = true; // Do not continue if any function returns false\n        for (var order = 0; order < Listeners.beforeSubmit.length; order++) {\n          var list = Listeners.beforeSubmit[order];\n          for (var i = 0; i < list.length; i++) {\n            result = list[i](listenerOptions);\n            if (result === false) {\n              break;\n            }\n          }\n        }\n        if (result === false) {\n          this.isSubmit = false;\n          return false;\n        }\n    */\n    CommandHelper.isSubmit = true;\n\n    const element: HTMLElement = document.documentElement; // XXX this might be the wrong element in case of shadow dom\n    Page.page(element).onBeforeUnload();\n\n    return true;\n  };\n\n}\n\nclass Transport {\n  static requests = [];\n  static currentActionId = null;\n  static pageSubmitted = false;\n  static startTime: Date;\n\n  /**\n   * @return true if the request is queued.\n   */\n  static request = function (req: () => void, submitPage: boolean, actionId?: string): boolean {\n    let index = 0;\n    if (submitPage) {\n      Transport.pageSubmitted = true;\n      index = Transport.requests.push(req);\n      //console.debug('index = ' + index)\n    } else if (!Transport.pageSubmitted) { // AJAX case\n      console.debug(\"Current ActionId = \" + Transport.currentActionId + \" action= \" + actionId);\n      if (actionId && Transport.currentActionId === actionId) {\n        console.info(\"Ignoring request\");\n        // If actionId equals currentActionId assume double request: do nothing\n        return false;\n      }\n      index = Transport.requests.push(req);\n      //console.debug('index = ' + index)\n      Transport.currentActionId = actionId;\n    } else {\n      console.debug(\"else case\");\n      return false;\n    }\n    console.debug(\"index = \" + index);\n    if (index === 1) {\n      console.info(\"Execute request!\");\n      Transport.startTime = new Date();\n      Transport.requests[0]();\n    } else {\n      console.info(\"Request queued!\");\n    }\n    return true;\n  };\n\n  // TBD XXX REMOVE is this called in non AJAX case?\n\n  static requestComplete = function (): void {\n    Transport.requests.shift();\n    Transport.currentActionId = null;\n    console.debug(\"Request complete! Duration: \" + (new Date().getTime() - Transport.startTime.getTime()) + \"ms; \"\n        + \"Queue size : \" + Transport.requests.length);\n    if (Transport.requests.length > 0) {\n      console.debug(\"Execute request!\");\n      Transport.startTime = new Date();\n      Transport.requests[0]();\n    }\n  };\n}\n"]}