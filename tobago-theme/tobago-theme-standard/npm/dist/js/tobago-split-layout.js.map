{"version":3,"file":"tobago-split-layout.js","sourceRoot":"../ts/","sources":["tobago-split-layout.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Page} from \"./tobago-page\";\n\nclass SplitLayout extends HTMLElement {\n\n  private offset: number;\n\n  /**\n   * Get the previous sibling element (without <style> elements).\n   */\n  // todo: calls of this method can probably be simplified\n  static previousElementSibling(element: HTMLElement): HTMLElement {\n    let sibling = element.previousElementSibling as HTMLElement;\n    while (sibling != null) {\n      if (sibling.tagName !== \"STYLE\") {\n        return sibling;\n      }\n      sibling = sibling.previousElementSibling as HTMLElement;\n    }\n    return null;\n  }\n\n  constructor() {\n    super();\n\n    let first = true;\n    let justAdded = false;\n    for (let child of this.children) {\n      if (justAdded) { // skip, because the just added had enlarges the list of children\n        justAdded = false;\n        continue;\n      }\n      if (getComputedStyle(child).display === \"none\") {\n        continue;\n      }\n      if (first) { // the first needs no splitter handle\n        first = false;\n        continue;\n      }\n      const splitter = document.createElement(\"div\");\n      splitter.classList.add(\n          this.orientation === \"horizontal\" ? \"tobago-splitLayout-horizontal\" : \"tobago-splitLayout-vertical\"\n      );\n      justAdded = true;\n      splitter.addEventListener(\"mousedown\", this.start.bind(this));\n      child.parentElement.insertBefore(splitter, child);\n    }\n  }\n\n  get orientation(): string {\n    return this.getAttribute(\"orientation\");\n  }\n\n  set orientation(orientation: string) {\n    this.setAttribute(\"orientation\", orientation);\n  }\n\n  start(event: MouseEvent): void {\n    event.preventDefault();\n    const splitter = event.target as HTMLElement;\n    const previous = SplitLayout.previousElementSibling(splitter);\n    this.offset = this.orientation === \"horizontal\"\n        ? event.pageX - previous.offsetWidth : event.pageY - previous.offsetHeight;\n    const mousedown = SplitLayoutMousedown.save(event, splitter);\n    document.addEventListener(\"mousemove\", this.move.bind(this));\n    document.addEventListener(\"mouseup\", this.stop.bind(this));\n    const previousArea = mousedown.previous;\n    if (this.orientation === \"horizontal\") {\n      previousArea.style.width = String(previousArea.offsetWidth + \"px\");\n    } else {\n      previousArea.style.height = String(previousArea.offsetHeight + \"px\");\n    }\n    previousArea.style.flexGrow = \"inherit\";\n    previousArea.style.flexBasis = \"auto\";\n    console.debug(\"initial width/height = '%s'\",\n        (this.orientation === \"horizontal\" ? previousArea.style.width : previousArea.style.height));\n  }\n\n  move(event: MouseEvent): void {\n    event.preventDefault();\n    const data = SplitLayoutMousedown.load();\n    const previousArea = data.previous;\n    if (previousArea) {\n      if (this.orientation === \"horizontal\") {\n        previousArea.style.width = String(event.pageX - this.offset) + \"px\";\n      } else {\n        previousArea.style.height = String(event.pageY - this.offset) + \"px\";\n      }\n    }\n  }\n\n  stop(event: MouseEvent): void {\n    document.removeEventListener(\"mousemove\", this.move.bind(this)); // fixme remove the real added\n    document.removeEventListener(\"mouseup\", this.stop.bind(this)); // fixme remove the real added\n    SplitLayoutMousedown.remove();\n  }\n}\n\n/**\n * Data class to store \"offset\" and \"splitter\"-element of the mouse down event in the tobago-page.\n */\ninterface SplitLayoutMousedownData {\n  readonly splitLayoutId: string;\n  readonly splitterIndex: number;\n  readonly horizontal: boolean;\n}\n\nclass SplitLayoutMousedown {\n\n  private data: SplitLayoutMousedownData;\n\n  static save(event: MouseEvent, splitter: HTMLElement): SplitLayoutMousedown {\n    const horizontal = splitter.classList.contains(\"tobago-splitLayout-horizontal\");\n    const previous = SplitLayout.previousElementSibling(splitter);\n    const data: SplitLayoutMousedownData = {\n      splitLayoutId: splitter.parentElement.id,\n      horizontal: horizontal,\n      splitterIndex: this.indexOfSplitter(splitter, horizontal)\n    };\n    Page.page(splitter).dataset.SplitLayoutMousedownData = JSON.stringify(data);\n    return new SplitLayoutMousedown(data);\n  }\n\n  static load(): SplitLayoutMousedown {\n    const element : HTMLElement = document.documentElement; // XXX this might be the wrong element in case of shadow dom\n    return new SplitLayoutMousedown(Page.page(element).dataset.SplitLayoutMousedownData);\n  }\n\n  static remove(): void {\n    const element : HTMLElement = document.documentElement; // XXX this might be the wrong element in case of shadow dom\n    Page.page(element).dataset.SplitLayoutMousedownData = null;\n  }\n\n  private static indexOfSplitter(splitter: HTMLElement, horizontal: boolean): number {\n    const list = splitter.parentElement.getElementsByClassName(\n        horizontal ? \"tobago-splitLayout-horizontal\" : \"tobago-splitLayout-vertical\");\n    for (let i = 0; i < list.length; i++) {\n      if (list.item(i) === splitter) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private constructor(data: SplitLayoutMousedownData | string) {\n    if (data) {\n      this.data = typeof data === \"string\" ? JSON.parse(data) : data;\n    }\n  }\n\n  get splitter(): HTMLElement {\n    return this.data ? document.getElementById(this.data.splitLayoutId).getElementsByClassName(\n        this.data.horizontal ? \"tobago-splitLayout-horizontal\" : \"tobago-splitLayout-vertical\")\n        .item(this.data.splitterIndex) as HTMLElement : null;\n  }\n\n  get previous(): HTMLElement {\n    return this.splitter ? SplitLayout.previousElementSibling(this.splitter) : null;\n  }\n}\n\ndocument.addEventListener(\"tobago.init\", function (event: Event): void {\n  if (window.customElements.get(\"tobago-split-layout\") == null) {\n    window.customElements.define(\"tobago-split-layout\", SplitLayout);\n  }\n});\n"]}