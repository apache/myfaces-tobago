{"version":3,"file":"tobago-tree-node.js","sourceRoot":"../ts/","sources":["tobago-tree-node.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Sheet} from \"./tobago-sheet\";\nimport {Tree} from \"./tobago-tree\";\n\nexport class TreeNode extends HTMLElement {\n\n  constructor() {\n    super();\n  }\n\n  connectedCallback(): void {\n    if (this.expandable && this.toggles !== null) {\n      this.toggles.forEach(element => element.addEventListener(\"click\", this.toggleNode.bind(this)));\n    }\n  }\n\n  private toggleNode(event: MouseEvent): void {\n    if (this.expanded) {\n      for (const icon of this.icons) {\n        icon.classList.remove(icon.dataset.tobagoOpen);\n        icon.classList.add(icon.dataset.tobagoClosed);\n      }\n      for (const image of this.images) {\n        if (image.dataset.tobagoClosed) {\n          image.src = image.dataset.tobagoClosed;\n        } else {\n          image.src = image.dataset.tobagoOpen;\n        }\n      }\n\n      this.deleteExpandedNode(this.index);\n      this.classList.remove(\"tobago-treeNode-markup-expanded\");\n\n      this.hideNodes(this.treeChildNodes);\n      if (this.tree) {\n        this.ajax(event, false);\n      }\n    } else {\n      for (const icon of this.icons) {\n        icon.classList.remove(icon.dataset.tobagoClosed);\n        icon.classList.add(icon.dataset.tobagoOpen);\n      }\n      for (const image of this.images) {\n        if (image.dataset.tobagoOpen) {\n          image.src = image.dataset.tobagoOpen;\n        } else {\n          image.src = image.dataset.tobagoClosed;\n        }\n      }\n\n      this.addExpandedNode(this.index);\n      this.classList.add(\"tobago-treeNode-markup-expanded\");\n\n      this.showNodes(this.treeChildNodes);\n      if (this.tree) {\n        this.ajax(event, this.treeChildNodes.length === 0);\n      }\n    }\n  }\n\n  private ajax(event: Event, renderTree: boolean): void {\n    jsf.ajax.request(\n        this.id,\n        event,\n        {\n          \"javax.faces.behavior.event\": \"change\",\n          execute: this.tree.id,\n          render: renderTree ? this.tree.id : null\n        });\n  }\n\n  private hideNodes(treeChildNodes: NodeListOf<TreeNode>): void {\n    for (const treeChildNode of treeChildNodes) {\n\n      if (treeChildNode.sheet) {\n        treeChildNode.closest(\".tobago-sheet-row\").classList.add(\"d-none\");\n      } else {\n        treeChildNode.classList.add(\"d-none\");\n      }\n\n      this.hideNodes(treeChildNode.treeChildNodes);\n    }\n  }\n\n  private showNodes(treeChildNodes: NodeListOf<TreeNode>): void {\n    for (const treeChildNode of treeChildNodes) {\n\n      if (treeChildNode.sheet) {\n        treeChildNode.closest(\".tobago-sheet-row\").classList.remove(\"d-none\");\n      } else {\n        treeChildNode.classList.remove(\"d-none\");\n      }\n\n      this.showNodes(treeChildNode.treeChildNodes);\n    }\n  }\n\n  private addExpandedNode(expandedNode: number): void {\n    const expandedNodes = new Set(JSON.parse(this.hiddenInputExpanded.value));\n    expandedNodes.add(expandedNode);\n    this.hiddenInputExpanded.value = JSON.stringify(Array.from(expandedNodes));\n  }\n\n  private deleteExpandedNode(expandedNode: number): void {\n    const expandedNodes = new Set(JSON.parse(this.hiddenInputExpanded.value));\n    expandedNodes.delete(expandedNode);\n    this.hiddenInputExpanded.value = JSON.stringify(Array.from(expandedNodes));\n  }\n\n  get tree(): Tree {\n    return this.closest(\"tobago-tree\");\n  }\n\n  get sheet(): Sheet {\n    return this.closest(\"tobago-sheet\");\n  }\n\n  private get expandable(): boolean {\n    return this.getAttribute(\"expandable\") === \"expandable\";\n  }\n\n  private get expanded(): boolean {\n    for (const expandedNodeIndex of this.expandedNodes) {\n      if (expandedNodeIndex === this.index) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  private get expandedNodes(): Set<number> {\n    return new Set(JSON.parse(this.hiddenInputExpanded.value));\n  }\n\n  private get hiddenInputExpanded(): HTMLInputElement {\n    if (this.tree) {\n      return this.tree.hiddenInputExpanded;\n    } else if (this.sheet) {\n      return this.sheet.getHiddenExpanded();\n    } else {\n      console.error(\"Cannot detect 'tobago-tree' or 'tobago-sheet'.\");\n      return null;\n    }\n  }\n\n  private get treeChildNodes(): NodeListOf<TreeNode> {\n    if (this.sheet) {\n      return this.closest(\"tbody\").querySelectorAll(\"tobago-tree-node[parent='\" + this.id + \"']\");\n    } else if (this.tree) {\n      return this.parentElement.querySelectorAll(\"tobago-tree-node[parent='\" + this.id + \"']\");\n    } else {\n      console.error(\"Cannot detect 'tobago-tree' or 'tobago-sheet'.\");\n      return null;\n    }\n  }\n\n  private get toggles(): NodeListOf<HTMLSpanElement> {\n    return this.querySelectorAll(\".tobago-treeNode-toggle\");\n  }\n\n  private get icons(): NodeListOf<HTMLElement> {\n    return this.querySelectorAll(\".tobago-treeNode-toggle i\");\n  }\n\n  private get images(): NodeListOf<HTMLImageElement> {\n    return this.querySelectorAll(\".tobago-treeNode-toggle img\");\n  }\n\n  get index(): number {\n    return Number(this.getAttribute(\"index\"));\n  }\n}\n\ndocument.addEventListener(\"tobago.init\", function (event: Event): void {\n  if (window.customElements.get(\"tobago-tree-node\") == null) {\n    window.customElements.define(\"tobago-tree-node\", TreeNode);\n  }\n});\n"]}