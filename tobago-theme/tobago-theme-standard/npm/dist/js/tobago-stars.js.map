{"version":3,"file":"tobago-stars.js","sourceRoot":"../ts/","sources":["tobago-stars.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {DomUtils} from \"./tobago-utils\";\n\nclass Stars extends HTMLElement {\n\n  private static leftOffset(element: HTMLElement): number {\n    let left = 0;\n\n    let currentElement = element;\n    while (currentElement) {\n      left += (currentElement.offsetLeft - currentElement.scrollLeft + currentElement.clientLeft);\n      currentElement = currentElement.offsetParent as HTMLElement;\n    }\n\n    return left;\n  }\n\n  constructor() {\n    super();\n  }\n\n  connectedCallback(): void {\n    const hiddenInput = this.querySelector(\"input[type=hidden]\") as HTMLInputElement;\n    const container = this.querySelector(\".tobago-stars-container\") as HTMLElement;\n    const tooltip = container.querySelector(\".tobago-stars-tooltip\") as HTMLElement;\n    const selected = container.querySelector(\".tobago-stars-selected\") as HTMLElement;\n    const unselected = container.querySelector(\".tobago-stars-unselected\") as HTMLElement;\n    const preselected = container.querySelector(\".tobago-stars-preselected\") as HTMLElement;\n    const slider = container.querySelector(\".tobago-stars-slider\") as HTMLInputElement;\n\n    const readonly = slider.readOnly;\n    const disabled = slider.disabled;\n    const required = slider.required;\n\n    const max = parseInt(slider.max);\n    const placeholder = parseInt(slider.placeholder);\n\n    if (parseInt(slider.min) === 0) {\n      slider.style[\"left\"] = \"-\" + (100 / max) + \"%\";\n      slider.style[\"width\"] = 100 + (100 / max) + \"%\";\n    }\n\n    const currentValue = parseInt(hiddenInput.value);\n    if (currentValue > 0) {\n      const percentValue = 100 * currentValue / max;\n      selected.style[\"width\"] = percentValue + \"%\";\n      unselected.style[\"left\"] = percentValue + \"%\";\n      unselected.style[\"width\"] = 100 - percentValue + \"%\";\n    } else if (placeholder) {\n      selected.classList.add(\"tobago-placeholder\");\n      const placeholderValue = 100 * placeholder / max;\n      selected.style[\"width\"] = placeholderValue + \"%\";\n      unselected.style[\"left\"] = placeholderValue + \"%\";\n      unselected.style[\"width\"] = 100 - placeholderValue + \"%\";\n    }\n\n    if (!readonly && !disabled) {\n      /* preselectMode is a Workaround for IE11: fires change event instead of input event */\n      let preselectMode = false;\n      slider.addEventListener(\"mousedown\", function (event: Event): void {\n        preselectMode = true;\n      });\n      slider.addEventListener(\"mouseup\", function (event: Event): void {\n        preselectMode = false;\n        selectStars();\n      });\n\n      slider.addEventListener(\"input\", function (event: Event): void {\n        preselectStars();\n      });\n      slider.addEventListener(\"touchend\", function (event: Event): void {\n        /* Workaround for mobile devices. TODO: fire AJAX request for 'touchend' */\n        // slider.trigger(\"change\");\n        slider.dispatchEvent(new Event(\"change\"));\n      });\n      slider.addEventListener(\"change\", function (event: Event): void {\n        if (preselectMode) {\n          preselectStars();\n        } else {\n          selectStars();\n        }\n      });\n\n      slider.addEventListener(\"touchstart\", touchstart);\n      slider.addEventListener(\"touchmove\", touchstart);\n    }\n\n    // XXX current issue: on ios-Safari select 5 stars and than click on 1 star doesn't work on labeled component.\n    function touchstart(event: TouchEvent): void {\n      /* Workaround for Safari browser on iPhone */\n      const target = event.currentTarget as HTMLInputElement;\n      const sliderValue = (parseInt(target.max) / target.offsetWidth)\n          * (event.touches[0].pageX - Stars.leftOffset(slider));\n      if (sliderValue > parseInt(target.max)) {\n        slider.value = target.max;\n      } else if (sliderValue < parseInt(target.min)) {\n        slider.value = target.min;\n      } else {\n        slider.value = String(sliderValue);\n      }\n      preselectStars();\n    }\n\n    function preselectStars(): void {\n      tooltip.classList.add(\"show\");\n\n      if (parseInt(slider.value) > 0) {\n        tooltip.classList.remove(\"trash\");\n        tooltip.textContent = (5 * (parseInt(slider.value)) / max).toFixed(2);\n\n        preselected.classList.add(\"show\");\n        preselected.style[\"width\"] = (100 * parseInt(slider.value) / max) + \"%\";\n      } else {\n        tooltip.textContent = \"\";\n        tooltip.classList.add(\"trash\");\n\n        if (placeholder) {\n          preselected.classList.add(\"show\");\n          preselected.style[\"width\"] = (100 * placeholder / max) + \"%\";\n        } else {\n          preselected.classList.remove(\"show\");\n        }\n      }\n    }\n\n    function selectStars(): void {\n      tooltip.classList.remove(\"show\");\n      preselected.classList.remove(\"show\");\n\n      if (parseInt(slider.value) > 0) {\n        selected.classList.remove(\"tobago-placeholder\");\n\n        const percentValue = 100 * parseInt(slider.value) / max;\n        selected.style[\"width\"] = percentValue + \"%\";\n        unselected.style[\"left\"] = percentValue + \"%\";\n        unselected.style[\"width\"] = 100 - percentValue + \"%\";\n\n        hiddenInput.value = slider.value;\n      } else {\n        if (placeholder) {\n          selected.classList.add(\"tobago-placeholder\");\n          const placeholderValue = 100 * placeholder / max;\n          selected.style[\"width\"] = placeholderValue + \"%\";\n          unselected.style[\"left\"] = placeholderValue + \"%\";\n          unselected.style[\"width\"] = 100 - placeholderValue + \"%\";\n        } else {\n          selected.classList.remove(\"tobago-placeholder\");\n          selected.style[\"width\"] = \"\";\n          unselected.style[\"left\"] = \"\";\n          unselected.style[\"width\"] = \"\";\n        }\n\n        hiddenInput.value = required ? \"\" : slider.value;\n      }\n    }\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function (event:Event): void {\n  window.customElements.define(\"tobago-stars\", Stars);\n});\n"]}