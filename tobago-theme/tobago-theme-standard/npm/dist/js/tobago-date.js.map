{"version":3,"file":"tobago-date.js","sourceRoot":"../ts/","sources":["tobago-date.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// @ts-ignore\nimport {Datepicker} from \"../node_modules/tobago-core/node_modules/vanillajs-datepicker\";\nimport {Page} from \"./tobago-page\";\n\ninterface DatePickerI18n {\n  days: string[];\n  daysShort: string[];\n  daysMin: string[];\n  months: string[];\n  monthsShort: string[];\n  today: string;\n  monthsTitle: string;\n  clear: string;\n  weekStart: number;\n  format: string;\n  titleFormat: string;\n}\n\ninterface DatePickerOptions {\n  buttonClass: string;\n  orientation: string;\n  autohide: boolean;\n  language: string;\n  todayBtn: boolean;\n  todayBtnMode: number;\n}\n\nclass DatePicker extends HTMLElement {\n\n  lastValue: string;\n\n  constructor() {\n    super();\n  }\n\n  connectedCallback(): void {\n    const field = this.field;\n    const locale: string = Page.page(this).locale;\n\n    const i18n = this.i18n;\n    i18n.titleFormat = \"MM y\"; // todo i18n\n    i18n.format = this.pattern;\n    Datepicker.locales[locale] = i18n;\n\n    const options: DatePickerOptions = {\n      buttonClass: \"btn\",\n      orientation: \"auto\",\n      autohide: true,\n      language: locale,\n      todayBtn: this.todayButton,\n      todayBtnMode: 1\n      // todo readonly\n      // todo show week numbers\n    };\n    const datepicker = new Datepicker(field, options);\n\n    // XXX these listeners are needed as long as we have a solution for:\n    // XXX https://github.com/mymth/vanillajs-datepicker/issues/13\n    // XXX the 2nd point is missing the \"normal\" change event on the input element\n    field.addEventListener(\"keyup\", (event) => {\n      // console.info(\"event -----> \", event.type);\n      if (event.metaKey || event.key.length > 1 && event.key !== \"Backspace\" && event.key !== \"Delete\") {\n        return;\n      }\n      // back up user's input when user types printable character or backspace/delete\n      const target = event.target as any;\n      target._oldValue = target.value;\n    });\n\n    field.addEventListener(\"focus\", (event) => {\n      // console.info(\"event -----> \", event.type);\n      this.lastValue = field.value;\n    });\n\n    field.addEventListener(\"blur\", (event) => {\n      // console.info(\"event -----> \", event.type);\n      const target = event.target as any;\n\n      // no-op when user goes to another window or the input field has no backed-up value\n      if (document.hasFocus() && target._oldValue !== undefined) {\n        if (target._oldValue !== target.value) {\n          target.datepicker.setDate(target._oldValue || {clear: true});\n        }\n        delete target._oldValue;\n      }\n\n      if (this.lastValue !== field.value) {\n        field.dispatchEvent(new Event(\"change\"));\n      }\n    });\n\n    datepicker.element.addEventListener(\"changeDate\", (event) => {\n      // console.info(\"event -----> \", event.type);\n      field.dispatchEvent(new Event(\"change\"));\n    });\n\n    // simple solution for the picker: currently only open, not close is implemented\n    this.querySelector(\".tobago-date-picker\")?.addEventListener(\"click\",\n        (event: MouseEvent) => {\n          this.field.focus();\n        }\n    );\n  }\n\n  get todayButton(): boolean {\n    return this.hasAttribute(\"today-button\");\n  }\n\n  set todayButton(todayButton: boolean) {\n    if (todayButton) {\n      this.setAttribute(\"today-button\", \"\");\n    } else {\n      this.removeAttribute(\"today-button\");\n    }\n  }\n\n  get pattern(): string {\n    return this.getAttribute(\"pattern\");\n  }\n\n  get i18n(): DatePickerI18n {\n    const i18n = this.getAttribute(\"i18n\");\n    return i18n ? JSON.parse(i18n) : undefined;\n  }\n\n  get field(): HTMLInputElement {\n    const rootNode = this.getRootNode() as ShadowRoot | Document;\n    return rootNode.getElementById(this.id + \"::field\") as HTMLInputElement;\n  }\n}\n\ndocument.addEventListener(\"tobago.init\", function (event: Event): void {\n  if (window.customElements.get(\"tobago-date\") == null) {\n    window.customElements.define(\"tobago-date\", DatePicker);\n  }\n});\n"]}