{"version":3,"file":"tobago-listener.js","sourceRoot":"../ts/","sources":["tobago-listener.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum Phase {\n  /** after the DOM was build */\n  DOCUMENT_READY,\n  /** after all images and CSS was loaded */\n  WINDOW_LOAD,\n  /** before sending a normal submit action */\n  BEFORE_SUBMIT,\n  /** after an AJAX call */\n  AFTER_UPDATE,\n  /** before ending a page */\n  BEFORE_UNLOAD,\n  /** before closing a window or tab */\n  BEFORE_EXIT,\n}\n\nexport enum Order {\n  EARLIER = 0,\n  EARLY = 1,\n  NORMAL = 2,\n  LATE = 3,\n  LATER = 4\n}\n\nclass ListenerList {\n\n  map: Map<Order, Array<(HTMLElement) => void>> = new Map([\n    [Order.EARLIER, []],\n    [Order.EARLY, []],\n    [Order.NORMAL, []],\n    [Order.LATE, []],\n    [Order.LATER, []]\n  ]);\n\n  add(listener: (HTMLElement) => void, order: Order): void {\n    this.map.get(order).push(listener);\n  }\n\n  execute(element?: HTMLElement): void {\n\n    this.map.forEach((listeners: Array<(HTMLElement) => void>, order: Order) => {\n      listeners.forEach(\n          (listener, index) => {\n            console.time(\"[tobago] execute \" + order + \" \" + index);\n            listener(element);\n            console.timeEnd(\"[tobago] execute \" + order + \" \" + index);\n          }\n      );\n    });\n  }\n}\n\nexport class Listener {\n\n  // XXX check if \"static\" is nice\n\n  static documentReady: ListenerList = new ListenerList();\n  static windowLoad: ListenerList = new ListenerList();\n  static beforeSubmit: ListenerList = new ListenerList();\n  static afterUpdate: ListenerList = new ListenerList();\n  static beforeUnload: ListenerList = new ListenerList();\n  static beforeExit: ListenerList = new ListenerList();\n\n  /**\n   * Register a function to be executed on certain events.\n   * @param listener Function to be executed.\n   * @param phase The phase when code should be executed (e. g. Phase.DOCUMENT_READY).\n   * @param order An optional order to sort function they depend on others (default: Tobago.Order.NORMAL).\n   */\n  static register(\n      listener: (HTMLElement) => void,\n      phase: Phase,\n      order: Order = Order.NORMAL): void {\n\n    switch (phase) {\n      case Phase.DOCUMENT_READY:\n        Listener.documentReady.add(listener, order);\n        break;\n      case Phase.WINDOW_LOAD:\n        Listener.windowLoad.add(listener, order);\n        break;\n      case Phase.BEFORE_SUBMIT:\n        Listener.beforeSubmit.add(listener, order);\n        break;\n      case Phase.AFTER_UPDATE:\n        Listener.afterUpdate.add(listener, order);\n        break;\n      case Phase.BEFORE_UNLOAD:\n        Listener.beforeUnload.add(listener, order);\n        break;\n      case Phase.BEFORE_EXIT:\n        Listener.beforeExit.add(listener, order);\n        break;\n      default:\n        console.error(\"Unknown phase: '\" + phase + \"'\");\n    }\n  }\n\n  static executeDocumentReady(element: HTMLElement): void {\n    console.time(\"[tobago] execute documentReady\");\n    Listener.documentReady.execute(element);\n    console.timeEnd(\"[tobago] execute documentReady\");\n  }\n\n  static executeWindowLoad(): void {\n    console.time(\"[tobago] execute windowLoad\");\n    Listener.windowLoad.execute();\n    console.timeEnd(\"[tobago] execute windowLoad\");\n  }\n\n  static executeBeforeSubmit(): void {\n    console.time(\"[tobago] execute beforeSubmit\");\n    Listener.beforeSubmit.execute();\n    console.timeEnd(\"[tobago] execute beforeSubmit\");\n  }\n\n  static executeAfterUpdate(element: HTMLElement): void {\n    console.time(\"[tobago] execute afterUpdate\");\n    Listener.afterUpdate.execute(element);\n    console.timeEnd(\"[tobago] execute afterUpdate\");\n  }\n\n  static executeBeforeUnload(): void {\n    console.time(\"[tobago] execute beforeUnload\");\n    Listener.beforeUnload.execute();\n    console.timeEnd(\"[tobago] execute beforeUnload\");\n  }\n\n  static executeBeforeExit(): void {\n    console.time(\"[tobago] execute beforeExit\");\n    Listener.beforeExit.execute();\n    console.timeEnd(\"[tobago] execute beforeExit\");\n  }\n}\n"]}